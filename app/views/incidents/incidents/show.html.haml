- provide :title, "Incident #{resource.incident_number} - ARCBA DAT"
%h1
  =resource.incident_number
  #{resource.city}, #{resource.state}
  %small
    =resource.date.to_s :dow_short
    -if resource.incident_type
      ==-
      =resource.humanized_incident_type

- tabs = %w(details summary cases timeline responders photos changes)

.tabbable
  %ul.nav.nav-tabs
    - tabs.select{|name| tab_authorized? name}.each_with_index do |name, idx|
      %li{class: ((idx==0) && 'active')}
        %a{href: '', data: {target: "#inc-#{name}", toggle: 'tab'}}=name.titleize
  
.tab-content
  - tabs.each_with_index do |name, idx|
    -if tab_authorized? name
      .tab-pane{class: ((idx==0) && 'active'), id: "inc-#{name}"}
        =render name

.modal.hide.fade#edit-modal
  .modal-header 
    %button.close(data-dismiss="modal") &times;
    %h3 Edit
  .modal-body
  .modal-footer
    %a.btn.btn-primary(data-dismiss="modal") Close

- content_for :footer_js do
  = javascript_include_tag "https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"
  :javascript
    config = #{map_config.to_json};
    incidentLocationController = new IncidentLocationController(#{resource.lat.to_json}, #{resource.lng.to_json}, config);
    eventLogsController = new IncidentEventLogsController();
    editPanelController = new IncidentEditPanelController(#{edit_incidents_incident_dat_path(resource).to_json});
    $(function() {
      var hash = window.location.hash;
      hash && $('ul.nav a[href="' + hash + '"]').tab('show');

      $('a[data-toggle=tab]').on('shown', function(evt) {
        window.location.hash = $(evt.target).attr('href')
      })
    });
