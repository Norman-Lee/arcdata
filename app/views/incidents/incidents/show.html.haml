- provide :title, "Incident #{resource.incident_number} - DCSOps"
%h2
  =resource.incident_number
  #{resource.city}, #{resource.state}
  %small
    -if can? :incident_details, resource
      =resource.address
    -if resource.open_incident?
      -if can? :close, resource
        =link_to 'Close', close_resource_path, class: 'btn', method: 'post', data: {confirm: 'Really close this incident?'}
      -if can? :mark_invalid, resource
        =link_to 'Invalid/No Response', mark_invalid_resource_path, class: 'btn btn-danger'
    -else
      -if can? :reopen, resource
        =link_to 'Reopen', reopen_resource_path, class: 'btn', method: 'post', data: {confirm: 'Really reopen this incident?'}

.incoming-table{data: {refresh: incidents_incident_responder_messages_path(resource, partial: 'incoming_table')}}
  =render partial: 'incidents/responder_messages/incoming_table', locals: {incident: resource}

- tabs = %w(details timeline responders cases attachments changes summary).select{|name| tab_authorized? name}

.tabbable
  %ul.nav.nav-tabs
    - tabs.each_with_index do |name, idx|
      %li{class: ((idx==0) && 'active')}
        %a{href: '', data: {target: "#inc-#{name}", toggle: 'tab'}}=name.titleize
  
.tab-content
  - tabs.each_with_index do |name, idx|
    .tab-pane{class: ((idx==0) && 'active'), id: "inc-#{name}", data: {refresh_name: name, refresh: url_for(partial: name)}}
      =render name

.modal.hide.fade#edit-modal
  .modal-header 
    %a.close(data-dismiss="modal") &times;
    %h3 Edit
  .modal-body
  .modal-footer
    %a.btn.btn-primary(data-dismiss="modal") Close

- content_for :footer_js do
  = google_maps_javascript
  
  :javascript
    $(function() {
      if ('hash' in window.location) {
        var hash = window.location.hash;
        hash && $('ul.nav a[data-target="' + hash + '"]').tab('show');
      }
      if ('history' in window && 'replaceState' in window.history) {
        $('a[data-toggle=tab]').on('shown', function(evt) {
          window.history.replaceState({}, '', $(evt.target).attr('data-target'))
        });
      }

      config = #{map_config.to_json};
      incidentLocationController = new IncidentLocationController(#{resource.lat.to_json}, #{resource.lng.to_json}, config);
      editPanelController = new IncidentEditPanelController();

      
    });

- if true # can edit incident report
  - content_for :footer_js do
    =incidents_goinstant_setup

