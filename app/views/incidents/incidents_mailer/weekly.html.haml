!!! 5
%html
  %head
    %title
      =@title
    /%link(rel="stylesheet" href="application.css")
    :scss
      h1, h2, h3 {
        font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
        
        line-height: 1.3;

        small {
          font-size: 75%;
        }
      }
      h1 {
        font-size: 24px;
      }
      h2 {
        font-size: 18px;
      }
      h3 {
        font-size: 14px;
        margin-bottom: 0;
      }
      .center {
        text-align: center;
      }
      .table {
        width: 100%;

        td {
          border-top: 1px solid rgb(221, 221, 221);
        }

        th {
          font-weight: bold;
        }
      }
      .nowrap {
        white-space: nowrap;
      }
      p {
        margin: 0;
      }
      .counts {
        width: 100%;
        font-size: 18px;
        font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
      }
      body {
        min-width: 500px;
      }
  %body
    %h1.center
      ARCBA Disaster Operations Report
      %br
      %small
        =@subtitle
    %table(style="width: 100%")
      %tr
        %td(style="vertical-align: top")
          %table.counts
            %tr
              %td.center
                %strong This Week
                %br
                =pluralize @weekly_stats.incident_count, "incident"
                %br
                =pluralize @weekly_stats.case_count, 'case'
                %br
                =pluralize @weekly_stats.client_count, 'client'
              %td.center
                %strong This Year
                %br
                =pluralize @yearly_stats.incident_count, "incident"
                %br
                =pluralize @yearly_stats.case_count, 'case'
                %br
                =pluralize @yearly_stats.client_count, 'client'
          %h2.center Incident Details
          - @incidents.each do |inc|
            %h3
              =inc.date.to_s :dow_short
              ==-
              #{inc.city}, #{inc.state}
              %small (#{inc.county.name})
            - dat = inc.dat_incident
            - if dat
              - adults = inc.num_adults; children = inc.num_children; units = dat.units_affected
              %p
                %strong Incident:
                =dat.incident_type.titleize
              %p
                %strong Impact:
                =[adults > 0 ? pluralize(adults, "adult") : nil, children > 0 ? pluralize(children, "child") : nil, units && units > 0 ? pluralize(units, "unit") : nil].compact.join(", ")
              %p
                %strong Services Provided:
                =inc.services_description
        %td(style="width: 200px; max-width: 200px; vertical-align: top; overflow: visible")
          %img{src: static_maps_url, style: "height: 400px; max-height: 400px !important; width: 200px !important"}
      %tr
        %td
          / Need this here as Apple mail sometimes won't display the last cell in a table
        %td
    
    %br
    %br
